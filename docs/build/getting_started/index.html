<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Getting Started · Dar_One</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>Dar_One</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Getting Started</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Basic-Structure"><span>Basic Structure</span></a></li><li class="toplevel"><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Setting-up-with-docker"><span>Setting up with docker</span></a></li><li><a class="tocitem" href="#Setting-up-on-local-machine"><span>Setting up on local machine</span></a></li><li class="toplevel"><a class="tocitem" href="#Workflow"><span>Workflow</span></a></li></ul></li><li><a class="tocitem" href="../beginner_tutorials/">Beginner Tutorials</a></li><li><a class="tocitem" href="../case_studies/">Case Studies</a></li><li><a class="tocitem" href="../">Modify Parameters</a></li><li><a class="tocitem" href="../all_docs/">All Documentation</a></li><li><a class="tocitem" href="../darwin_background/">Darwin Background</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Getting Started</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Getting Started</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/barbara42/Dar_One/blob/main/docs/src/getting_started.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Getting-Started"><a class="docs-heading-anchor" href="#Getting-Started">Getting Started</a><a id="Getting-Started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-Started" title="Permalink"></a></h1><p>DAR1 is a tool for designing and running experiments simulating the marine microbiome within a single cube of water. The biogeochemical forcing is powered by the <a href="https://darwinproject.mit.edu/">MIT Darwin Model</a>, and DAR1 provides a Julia interface to build, configure, and run experiments with a simple, streamlined workflow. </p><p><img src="../images/dar1_ecosystem.png" alt="dar1 ecosystem"/></p><p>DAR1 Model Configuration: The DAR1 system models a single, well mixed parcel of water. The standard configuration consists of the DARWIN ecosystem-biogeochemical model, with free gas exchange with the atmosphere. Horizontal and other vertical fluxes are set to zero. These conditions can be modified by the user.</p><h1 id="Basic-Structure"><a class="docs-heading-anchor" href="#Basic-Structure">Basic Structure</a><a id="Basic-Structure-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Structure" title="Permalink"></a></h1><p>DAR1 is composed of three main parts: the MITgcm Darwin code, a configuration made for DAR1, and the julia interface to modify the configuration and run the model. </p><ul><li><a href="https://github.com/barbara42/Dar_One">DAR1</a> - Julia interface for organizing experiments and setting up parameters for model runs <ul><li><code>MITgcm_path</code> variable needs to point to darwin3</li></ul></li><li><a href="https://github.com/darwinproject/darwin3">darwin3</a> - MITgcm source code set up to include all things Darwin <ul><li><code>dar_one_config</code> - folder for the base configuration files for DAR1, which lives in the darwin3/verification/ folder. (<a href="https://github.com/barbara42/dar_one_config">DAR1_config github</a>)</li></ul></li></ul><p>Experiments are designed and run in a Julia file using the DAR1 Julia interface. This will create a unique run folder nested underneath the MITgcm darwin code and the dar<em>one</em>config folder. You will never have to look at the fortran of MITgcm Darwin or at the configuration files! However, output of the experiment is saved underneath that unique run folder that is created in <code>darwin3/verification/dar_one_config/run</code>.</p><p><img src="../images/dar1_anatomy.png" alt="DAR1 Anatomy"/></p><h1 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h1><p>DAR1 can be run in one of two ways. </p><ol><li>In a <strong>docker container</strong> using the DAR1_docker image, where all dependencies are handled for you </li><li>On your local machine, where you have to set up the environment, download dependencies, etc <ul><li>this is more time consuming, and I strongly recommend using the docker image</li><li>instructions for local setup are below</li></ul></li></ol><h2 id="Setting-up-with-docker"><a class="docs-heading-anchor" href="#Setting-up-with-docker">Setting up with docker</a><a id="Setting-up-with-docker-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-with-docker" title="Permalink"></a></h2><p>(1) Download and install <a href="https://www.docker.com/">docker desktop</a>.</p><ul><li>Run the docker application, which will start up the docker &quot;daemon&quot; </li><li>The docker daemon must be running in order to download the DAR1 image and to start up a container</li></ul><p>(2) Get the <a href="https://hub.docker.com/repository/docker/birdy1123/dar1">DAR1_docker image</a>.</p><ul><li><p>using the command line, run </p><p><code>docker pull birdy1123/dar1</code></p></li><li><p>If you go to the &quot;Images&quot; tab in the docker desktop UI, you should see &quot;birdy1123/DAR1_docker&quot;</p></li></ul><p>(3) Run a container based on the DAR1_docker image</p><ul><li><p>using the command line, run </p><p><code>docker run -it birdy1123/dar1</code> </p></li><li><p>this runs the container in interactive mode (<code>-i</code>) with terminal access (<code>-t</code>) </p></li><li><p>you should see the prompt change to <code>root@some-number:/dar_one_docker#</code></p></li><li><p>once the container is running, you can also connect to a new bash terminal inside the container using the command <code>docker exec -it container_id /bin/bash</code>. The container id can be found in the Docker desktop app or the &quot;some-number&quot; that appears in the previous bullet point. </p></li></ul><p>You&#39;re now ready for the <a href="https://barbara42.github.io/Dar_One/build/beginner_tutorials/">beginner tutorial</a>!</p><h2 id="Setting-up-on-local-machine"><a class="docs-heading-anchor" href="#Setting-up-on-local-machine">Setting up on local machine</a><a id="Setting-up-on-local-machine-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-on-local-machine" title="Permalink"></a></h2><p>You will need to clone 3 git repositories</p><ul><li>DAR1</li><li>darwin3 </li><li>dar<em>one</em>config</li></ul><p>First, we will clone the DAR1 code. </p><pre><code class="nohighlight hljs">git clone https://github.com/barbara42/Dar_One.git</code></pre><p>Then in a directory of your choosing, clone the MITgcm Darwin code. I put this in a folder called &quot;climate_models&quot; on my desktop.</p><pre><code class="nohighlight hljs">git clone https://github.com/darwinproject/darwin3.git</code></pre><p>Once darwin3 code is cloned, we will navigate to the <code>/verification</code> folder underneath it. </p><pre><code class="nohighlight hljs">cd darwin3/verification</code></pre><p>Here, under <code>darwin3/verification</code>, we will clone the <code>dar_one_config</code> repository. </p><pre><code class="nohighlight hljs">git clone https://github.com/barbara42/dar_one_config.git</code></pre><p>After these steps, you should have </p><ol><li>the DAR1 source code </li><li>the darwin3 source code</li><li>the <code>dar_one_config</code> code nested under <code>darwin3/verification</code></li></ol><h3 id="Dependencies"><a class="docs-heading-anchor" href="#Dependencies">Dependencies</a><a id="Dependencies-1"></a><a class="docs-heading-anchor-permalink" href="#Dependencies" title="Permalink"></a></h3><p>In order to build and run the MITgcm on your machine, you need to have the following installed as well</p><ul><li>gfortran</li><li>netcdf </li></ul><p>For the Julia code, you will need to install julia and the following packages </p><ul><li>OrderedCollections</li><li>Suppressor</li><li>ClimateModels</li><li>NCDatasets</li></ul><p>The Julia dependencies are also listed in the file at the top level of <code>Dar_One/packages.jl</code>. You can automatically install the Julia dependencies by running <code>julia packages.jl</code>.</p><p>If you get errors when building the model, see the <a href="https://mitgcm.readthedocs.io/en/latest/getting_started/getting_started.html#">MITgcm getting started guide</a> to help troubleshoot.  </p><p>You can also see the dockerfile used <a href=".">here</a></p><pre><code class="nohighlight hljs">FROM --platform=linux/amd64 ubuntu:latest 
WORKDIR /dar_one_docker
COPY . . 

RUN apt-get update -y
RUN apt-get install wget -y
RUN apt-get install vim -y

# download, install, and link julia 
RUN wget https://julialang-s3.julialang.org/bin/linux/x64/1.8/julia-1.8.2-linux-x86_64.tar.gz
RUN tar zxvf julia-1.8.2-linux-x86_64.tar.gz
ENV PATH=&quot;${PATH}:/dar_one_docker/julia-1.8.2/bin&quot;
# install julia packages 
RUN julia packages.jl

# other dependencies 
RUN apt-get install -y gfortran make 
RUN apt-get install -y python-is-python3
# future: try netcdf-bin instead? does it still work? 
RUN apt-get install -y libnetcdff-dev </code></pre><h1 id="Workflow"><a class="docs-heading-anchor" href="#Workflow">Workflow</a><a id="Workflow-1"></a><a class="docs-heading-anchor-permalink" href="#Workflow" title="Permalink"></a></h1><p>For more in-depth instructions, check out the <a href="https://barbara42.github.io/Dar_One/build/beginner_tutorials/">beginner tutorials</a></p><p>In general, experiments with DAR1 are divided into two main steps </p><ol><li>Building<ul><li>grid size</li><li>nutrient cycling</li></ul></li><li>Running<ul><li>set up experiment config</li><li>initialize parameters</li></ul></li></ol><p>I like to separate these out into two scripts because the build step only has to be done once for each experiment setup. After you settle on what grid size to use (classically 1x1) and what nutrient setup (classically freely cycling, can also be set to constant available nutrients), you can modify all other parameters without having to re-build. </p><p>I recommend creating a folder at the top level of the <code>Dar_One</code> directory with the name <code>your-name-experiments</code>, and putting all scripts you create in there. </p><p>For every DAR1 script, you will first import DarOneTools. </p><pre><code class="nohighlight hljs">include(&quot;../src/DarOneTools.jl&quot;)
using .DarOneTools</code></pre><p>Next you must always make sure you have a line specifying the correct value for <code>MITgcm_path[1]</code>. If you are using the docker, it will be set to &quot;/dar<em>one</em>docker/darwin3&quot;. Otherwise, you will point it to the direcotry of <a href="https://github.com/darwinproject/darwin3">darwin3</a> on your local machine. </p><pre><code class="nohighlight hljs"># the path to the Darwin version of the MITgcm
MITgcm_path[1] = &quot;/dar_one_docker/darwin3&quot; </code></pre><p>You build with the following function.</p><pre><code class="nohighlight hljs">build(base_configuration)</code></pre><p>Once the model has been built, you can run multiple experiments with different values for the intial parameters. I like to put the previous code in one file, and the code to initialize and run an experiment in another.</p><p>For the run script, you will also have to import DarOneTools and set the MITgcm path. </p><pre><code class="nohighlight hljs">include(&quot;../src/DarOneTools.jl&quot;)
using .DarOneTools

# the path to the Darwin version of the MITgcm
MITgcm_path[1] = &quot;/dar_one_docker/darwin3&quot; </code></pre><p>Set up experiment config id </p><pre><code class="nohighlight hljs">config_id = &quot;unique-experiment-name&quot; # CHANGE ME
config_obj, rundir = create_MITgcm_config(config_id)
setup(config_obj)</code></pre><p>The next step is to modify parameters (in-depth descriptions in <a href="https://barbara42.github.io/Dar_One/build/beginner_tutorials/">beginnger tutorial</a>). For modifying parameters, you will need to pass the <code>config_obj</code> to each update function. </p><p>Then run the model. </p><pre><code class="nohighlight hljs">run(config_obj)</code></pre><p>To recap the basic workflow: </p><ul><li>Always import <code>DarOneTools</code> and set <code>MITgcm_path</code></li><li>Build<ul><li>set your grid size</li><li>set nutrients to cycle or stay constant </li><li>build</li></ul></li><li>Run<ul><li>setup experiment config</li><li>modify parameters </li><li>run</li></ul></li></ul></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="../beginner_tutorials/">Beginner Tutorials »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Wednesday 12 July 2023 12:08">Wednesday 12 July 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
