<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Beginner Tutorials · Dar_One</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../getting_started/">Dar_One</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../getting_started/">Getting Started</a></li><li class="is-active"><a class="tocitem" href>Beginner Tutorials</a><ul class="internal"><li><a class="tocitem" href="#Modifying-Parameters"><span>Modifying Parameters</span></a></li><li><a class="tocitem" href="#Understanding-and-Plotting-Results"><span>Understanding and Plotting Results</span></a></li><li class="toplevel"><a class="tocitem" href="#Grid"><span>Grid</span></a></li><li class="toplevel"><a class="tocitem" href="#Constant-Nutrients"><span>Constant Nutrients</span></a></li></ul></li><li><a class="tocitem" href="../case_studies/">Case Studies</a></li><li><a class="tocitem" href="../">Modify Parameters</a></li><li><a class="tocitem" href="../all_docs/">All Documentation</a></li><li><a class="tocitem" href="../darwin_background/">Darwin Background</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Beginner Tutorials</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Beginner Tutorials</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/barbara42/Dar_One/blob/main/docs/src/beginner_tutorials.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Basic-DAR1-Run"><a class="docs-heading-anchor" href="#Basic-DAR1-Run">Basic DAR1 Run</a><a id="Basic-DAR1-Run-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-DAR1-Run" title="Permalink"></a></h1><p>This is a very simple tutorial, so I&#39;ll walk you through line-by-line whats going on in the  <code>2_run_example.jl</code> file. </p><p>If you&#39;re using docker, to open up the file using the commandline, run  <code># vim 2_run_example.jl</code>. Then you can use <a href="https://coderwall.com/p/adv71w/basic-vim-commands-for-getting-started">vim commands</a> to explore and edit the file. </p><p>(1) First, we have to import our dependencies.</p><pre><code class="nohighlight hljs"># DarOneTools
include(&quot;../src/DarOneTools.jl&quot;)
using .DarOneTools
# other packages 
using ClimateModels</code></pre><p>The <code>include</code> statement loads the <code>DarOneTools</code> from the <code>/src</code> directory. Perhaps in the future  <code>DarOneTools</code> will be a julia package that can be installed with the package manager, but for now its simply local code that we load up! The <code>.</code> in front of <code>DarOneTools</code> tells julia to look inside the current module for <code>DarOneTools</code>.  </p><p>(2) After including our dependencies, we have to specify the <code>MITgcm_path</code>. This tells <code>Dar_One</code> where  to look for the Darwin MITgcm code. The default value will work if using the docker. Otherwise,  paste in the path to where you downloaded <code>darwin3</code>. </p><pre><code class="nohighlight hljs"># the path to the Darwin version of the MITgcm 
MITgcm_path[1] = &quot;/dar_one_docker/darwin3&quot; # CHANGE ME (unless using docker)</code></pre><p>Next, we create a unique identifier for our run. </p><pre><code class="nohighlight hljs"># unique name for your run 
config_id = &quot;beginner_tutorial&quot; # CHANGE ME</code></pre><p>Then, we create an <code>MITgcm_config</code> object using that identifier </p><pre><code class="nohighlight hljs"># create config object 
config_obj, rundir = create_MITgcm_config(config_id)</code></pre><p>Lastly, we have to run <code>setup</code> to create the directories and files that your simulation is  going to use. </p><pre><code class="nohighlight hljs"># Set up! Creating file structure and linking stuff
setup(config_obj)</code></pre><p><strong>The <code>setup</code> fuction can only be run once per unique identifier. While you are troubleshooting the parameteres, comment this line out!</strong></p><p>Awesome! Now we have a <code>config_obj</code> that points to all the files and folders needed for the run.</p><h2 id="Modifying-Parameters"><a class="docs-heading-anchor" href="#Modifying-Parameters">Modifying Parameters</a><a id="Modifying-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Modifying-Parameters" title="Permalink"></a></h2><p>For a full list of parameters to modify, including more in-depth descriptions, see DOCUMENTAION(TODO - link).</p><p>Whenever you update a parameter, the function first takes in the <code>config_obj</code> of type <code>MITgcm_config</code> that we created in the previous step. This tells <code>Dar_One</code> where the files are that we are  aiming to modify. </p><p>For this tutorial, we are keeping it simple. First, we are going to specify how long the model will run by setting the end time. </p><pre><code class="nohighlight hljs"># length of run 
end_time = 2880 # one year, in iterations
update_end_time(end_time, config_obj)</code></pre><p>Next we will set the temperature to a constant value. </p><pre><code class="nohighlight hljs"># temperature
new_temp = 30 # celius
update_temperature(config_obj, new_temp)</code></pre><p><code>Dar_One</code> by default doesn&#39;t have many nutrients available, only salinity, alkalinity, and oxygen  are initialized. We need to add in starting nutrient concentrations, so our little plankton  don&#39;t die off. We&#39;re going to set the initial concentrations of nitrate (NO3), phosphate (PO4), and iron (FeT) using the following code. These values are in mmol per m^3. These values were chosen  by looking at the range of nutrient concentrations we see in the Northern Pacific gyre.  </p><pre><code class="nohighlight hljs"># NO3
new_NO3_val = 2 
update_NO3(config_obj, new_NO3_val)
#PO4
new_PO4_val = 0.1
update_PO4(config_obj, new_PO4_val)
# FeT
new_FeT_val = 1e-3
update_FeT(config_obj, new_FeT_val)</code></pre><p>Finally, we will set the initial concentration of Procholorococcus. </p><pre><code class="nohighlight hljs"># Prochlorococcus (mmol per m^3)
pro_val = 1e-3
update_pro(config_obj, pro_val)</code></pre><p>Now that we have all of our desired parameters set, we are ready to run the model. </p><pre><code class="nohighlight hljs">dar_one_run(config_obj)</code></pre><p>If you&#39;re using docker, you can run this file by using the command (in the docker bash prompt) <code># julia 2_run_example.jl</code> </p><p>You should see output similar to this:</p><pre><code class="nohighlight hljs">[ Info: 1 launching...
[ Info: 1 using MITgcm_launch in ModelSteps.jl
[ Info: 1 launching in ModelSteps!
** WARNING ** DARWIN_EXF_READPARMS: default constant wind speed   5.000 m/s is used
** WARNING ** OFFLINE_RESET_PARMS: =&gt; turn on exactConserv to compute wVel
SET_REF_STATE: Unable to compute reference stratification
SET_REF_STATE:  with EOS=&quot;POLY3&quot; ; set dBdrRef(1:Nr) to zeros
Note: The following floating-point exceptions are signalling: IEEE_UNDERFLOW_FLAG
STOP NORMAL END
[ Info: 1 run did not fail!!!!! 
[ Info: 1 run completed
[ Info: 1 time elapsed: 50.518673042 seconds
[ Info: 1 Output in directory /dar_one_docker/darwin3/verification/dar_one_config/run/beginner_tutorial/run, most recent ecco folder </code></pre><p>Don&#39;t worry, those warnings are totally normal :) </p><h2 id="Understanding-and-Plotting-Results"><a class="docs-heading-anchor" href="#Understanding-and-Plotting-Results">Understanding and Plotting Results</a><a id="Understanding-and-Plotting-Results-1"></a><a class="docs-heading-anchor-permalink" href="#Understanding-and-Plotting-Results" title="Permalink"></a></h2><p>As the output from the previous run suggests, all of the information about your simulation lives in the folder <code>/dar_one_docker/darwin3/verification/dar_one_config/run/beginner_tutorial/run</code> (or, if running locally, underneath your <code>darwin3</code> folder). </p><p>Let&#39;s look at the contents of this folder <code># cd /dar_one_docker/darwin3/verification/dar_one_config/run/beginner_tutorial/run</code> <code># ls</code></p><p>You&#39;ll see a lot of files, but look for the folder that starts with <code>ecco_gud_[DATE]_0001</code>. </p><p>Let&#39;s move inside this folder and look at its contents. </p><p><code># cd ecco_gud_[DATE]_0001</code></p><p><code># ls</code> </p><p>Here&#39;s all our output, in <a href="https://www.unidata.ucar.edu/software/netcdf/">netCDF</a> form! You can tell by the <code>.nc</code> filetype extension at the end of each file name. Each of these files contains different information about whats going on inside <code>Dar_One</code>, but for now <strong>we are just going to focus on the <code>3d.some_number.nc</code> file.</strong> (For a more in-depth description of all the forms of output we get, see <a href="TODO: LINK">DOCUMENTATION</a>)</p><p>The <code>3d.nc</code> file contains information about nutrient levels and the biomass of all the phytoplankton types. </p><h1 id="Grid"><a class="docs-heading-anchor" href="#Grid">Grid</a><a id="Grid-1"></a><a class="docs-heading-anchor-permalink" href="#Grid" title="Permalink"></a></h1><p>MITgcm DARWIN is built to run in a grid, calculating the fluxes as things flow from one grid cell to another. By turning off advection and diffusion between grid cells, we can essentially run DAR1 in parallel. That is, multiple blocks of water that do not interact with each other. </p><p>In order to run DAR1 in parallel, you first must specify the number of cells in the X and Y direction before building. In this example, we&#39;re creating a 4x4 grid.</p><pre><code class="nohighlight hljs">nX = 4
nY = 4
update_grid_size(nX, nY)
build(base_configuration)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If you change grid size, you MUST rebuild </p></div></div><p>If you do not want to change the size of the grid, you do not have to rebuild for each run. </p><p>As with the basic tutorial, we then create our config object </p><pre><code class="nohighlight hljs"># create and set up config 
config_name = &quot;grid-tutorial-4x4&quot;
config_obj, rundir = create_MITgcm_config(config_name)
setup(config_obj)</code></pre><p>But we now have the additional step of telling the run-time parameters that we are using a new grid size. </p><pre><code class="nohighlight hljs">update_delX_delY_for_grid(config_obj, nX, nY) </code></pre><p>Setting up how long to run for and the write frequency is the same as a basic run. However, setting the tracer values for each grid cell is slightly different. In the basic example, we are running a 1x1 grid, so we only have 1 set of initial values to specify. In a larger grid, we must specify the tracer values for each grid cell. This is done by creating an nX by nY matrix for each tracer then using the <code>init_tracer_grid</code> method. </p><pre><code class="nohighlight hljs">tracer_name = &quot;TRAC21&quot; #prochloroccocus
# create a 4x4 matrix where each value is 0.01
init_matrix = repeat(repeat([0.01], 4), outer=(1,4)) 
init_tracer_grid(config_obj, tracer_name, init_matrix)</code></pre><p>To set all nutients, it is easiest to do it in a for loop. Here I am using values grabbed from surface waters slightly north of Hawaii in August. At first, I am setting nutrient values to be the same across all grid cells. </p><pre><code class="nohighlight hljs">nutrients = [1920.6353
4.3627567
0.114378
0.23194869
0.6204238
3.8048208e-7
2.5234492
0.8200485
0.1093398
0.0068337377
6.8771224e-6
0.0664213
0.008856173
0.0005535108
5.535108e-7
0.0017452012
0.0008702652
2286.9731
208.42433]

for i in range(1, 19)
    init_matrix = repeat(repeat([nutrients[i]], 4), inner=(1,4))
    tracer_name = tracer_id_to_name(i) # tracer ID conveniently lines up with indexing nutrients
    init_tracer_grid(config_obj, tracer_name, init_matrix)
end</code></pre><p>Now, I want to change the NO3 levels to be increasing along one axis. </p><pre><code class="nohighlight hljs">tracer_name = &quot;TRAC02&quot;
no3_matrix = repeat(transpose(LinRange(3.0, 8.0, 4)), outer=(4,1))
init_tracer_grid(config_obj, tracer_name, init_matrix)</code></pre><p>Reminder, to find a list of all the tracers and their respectice IDs and names, see <a href="LINK TODO">darwin background</a>.</p><p>Lastly, temperature is treated differently from tracers, so it has it&#39;s own initialization function <code>init_temperature_grid</code>. Here we will set the grid to have increasing temperature along the one axis. </p><pre><code class="nohighlight hljs">temp_matrix = repeat(LinRange(20, 40, 4), inner=(1,4))
init_temperature_grid(config_obj, init_matrix)</code></pre><p>And finally, we can run! </p><pre><code class="nohighlight hljs">dar_one_run(config_obj)</code></pre><p>To recap, in this example we created a 4x4 grid of DAR1s, each with the same initial amount of nutrients (with the exception of NO3) and prochlorococcus. Along one axis, we initialized each grid cell to have 3.0, 4.67, 6.33, and 8.0 mmol NO3, and along the other axis we set the temperature to be 20.0, 26.67, 33.33, and 40.0 degrees C. </p><h1 id="Constant-Nutrients"><a class="docs-heading-anchor" href="#Constant-Nutrients">Constant Nutrients</a><a id="Constant-Nutrients-1"></a><a class="docs-heading-anchor-permalink" href="#Constant-Nutrients" title="Permalink"></a></h1><p>In a normal DAR1 configuration, the nutrients cycle through organic pathways and are then remineralized. When organisms grow, they take the nutrients out of the water and turn them into biomass. In a &quot;constant nutrient&quot; state, however, we can hold the amount of nutrients available in the water constant, so that the uptake by organisms doesn&#39;t deplete the reserve. </p><p>With DAR1 you can hold any subset of the nutrients constant. As with a grid setup, this requires built-time changes, made by using the <code>hold_nutrients_constant</code> method before building. There are 19 nutrient tracers (DIC, NO3, NO2, NH4, PO4, SiO2, FeT, DOC, DON, DOP, DOFe, PIC, POC, PON, PIP, PISi, POFe, ALK, O2), and <code>hold_nutrients_constant</code> takes a list of length 19, each element representing the nutrients in the order they are listed. In that list, a 0 represents holding a nutrient constant (dN/dt = 0), and 1 means that the concentration of that nutrient will be depleted and replentished with biomass growth and remineralization. </p><p>To set all nutrients constant, use the following code </p><pre><code class="nohighlight hljs">param_list = zeros(19) # hold everything constant 
hold_nutrients_constant(param_list)
# BUILD 
build(base_configuration)</code></pre><p>Here is an example of allowing most nutrients to cycle, but hold only iron (FeT) constant. </p><pre><code class="nohighlight hljs">param_list = zeros(19) # hold everything constant 
param_list[7] = 1 # FeT is 7th in the list of nutrients (TRAC07)
hold_nutrients_constant(param_list)
# BUILD 
build(base_configuration)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If you change nutrient cycling, you MUST rebuild </p></div></div><p>After doing this once, in the future you should always specify which nutrients you hold constant or allow to cycle in future builds. To make sure all nutrients are allowed to cycle, use the following code </p><pre><code class="nohighlight hljs">param_list = ones(19) # let all nutrients cycle 
hold_nutrients_constant(param_list)
# BUILD 
build(base_configuration)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../getting_started/">« Getting Started</a><a class="docs-footer-nextpage" href="../case_studies/">Case Studies »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 22 June 2023 12:00">Thursday 22 June 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
